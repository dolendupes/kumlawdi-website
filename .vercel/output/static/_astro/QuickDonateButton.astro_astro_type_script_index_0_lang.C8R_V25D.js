const j="pk_test_your_publishable_key_here",Q="http://localhost:3000/api/create-payment-intent";(function(){const P=()=>{const O=new URLSearchParams(window.location.search);let x=!1;const K=["quickdonate","donate","qd"];for(const[e,n]of O.entries()){const t=e.toLowerCase(),s=n.toLowerCase();if(K.includes(t)&&s==="true"){x=!0,console.log("[Quick Donate] Enabled via URL parameter:",e);break}}const f=document.getElementById("quick-donate-container");if(!x){f&&f.classList.add("hidden");return}if(f){let s,a,i;const r=()=>{const o=document.getElementById("quick-donate-modal");return o&&!o.classList.contains("hidden")},d=()=>{if(r()){console.log("[Quick Donate] Skipping show - modal is open"),s=setTimeout(()=>{d()},2e3);return}f.classList.remove("hidden"),console.log("[Quick Donate] Button shown"),a=setTimeout(()=>{u()},3e4)},u=()=>{if(r()){console.log("[Quick Donate] Skipping hide - modal is open"),a=setTimeout(()=>{u()},2e3);return}f.classList.add("hidden"),console.log("[Quick Donate] Button hidden"),i=setTimeout(()=>{d()},6e4)};window.quickDonateResumeCycle=()=>{a&&clearTimeout(a),i&&clearTimeout(i),s&&clearTimeout(s),f.classList.contains("hidden")?s=setTimeout(()=>{d()},1e3):a=setTimeout(()=>{u()},3e4)},s=setTimeout(()=>{d()},5e3),window.addEventListener("beforeunload",()=>{s&&clearTimeout(s),a&&clearTimeout(a),i&&clearTimeout(i)})}else{console.warn("[Quick Donate] Container element not found");return}let E=null,y=null,k=10;const c=["images/cartoons/cartoon-yak-1.jpg","images/cartoons/cartoon-yak-2.jpg","images/cartoons/cartoon-auto-1.jpg","images/cartoons/cartoon-harry-1.jpg"],R=1e4;(()=>{const e=document.getElementById("cartoon-kid-image"),n=document.getElementById("heart-icon"),t=document.getElementById("cartoon-kid-container");if(!e||!n||c.length===0){n.style.display="block",t?.style.setProperty("display","none");return}const s=()=>{{const o=sessionStorage.getItem("quickDonateKidIndex"),l=sessionStorage.getItem("quickDonateKidLastUpdate"),L=Date.now();if(o&&l&&L-parseInt(l)<R)return parseInt(o);{const m=o?(parseInt(o)+1)%c.length:0;return sessionStorage.setItem("quickDonateKidIndex",m.toString()),sessionStorage.setItem("quickDonateKidLastUpdate",L.toString()),m}}},a=o=>{const l=(()=>{const g=document.querySelector("base");return g&&g.href?g.href.replace(window.location.origin,""):window.location.pathname.startsWith("/kumlawdi-website/")?"/kumlawdi-website/":"/"})(),L=c[o],m=`${l}${L}`;e.src=m,e.style.display="block",n.style.display="none",t?.style.setProperty("display","flex")},i=()=>{const o=document.getElementById("modal-cartoons-container"),l=document.getElementById("modal-heart-icon");if(!o||!l||c.length===0)return;const L=(()=>{const m=document.querySelector("base");return m&&m.href?m.href.replace(window.location.origin,""):window.location.pathname.startsWith("/kumlawdi-website/")?"/kumlawdi-website/":"/"})();o.innerHTML="",c.forEach((m,g)=>{const T=document.createElement("div");let S="w-16 h-16",N="ring-2 ring-brand-secondary/20";g===0||g===c.length-1?S="w-14 h-14":(S="w-20 h-20",N="ring-2 ring-brand-secondary/30 shadow-md"),T.className=`${S} rounded-full overflow-hidden ${N} transition-transform duration-300 hover:scale-110`;const D=document.createElement("img");D.src=`${L}${m}`,D.alt="Support our mission",D.className="w-full h-full object-cover rounded-full",T.appendChild(D),o.appendChild(T)}),o.style.display="flex",l.style.display="none"},r=()=>{i()},d=()=>{},u=s();a(u),c.length>1&&setInterval(()=>{const l=(parseInt(sessionStorage.getItem("quickDonateKidIndex")||"0")+1)%c.length;sessionStorage.setItem("quickDonateKidIndex",l.toString()),sessionStorage.setItem("quickDonateKidLastUpdate",Date.now().toString()),e.style.opacity="0",setTimeout(()=>{a(l),e.style.opacity="1"},300)},R),window.quickDonateModalCycling={start:r,stop:d,update:i}})();try{E=Stripe(j)}catch(e){console.warn("Stripe initialization failed:",e)}const b=document.getElementById("quick-donate-button"),h=document.getElementById("quick-donate-modal"),$=document.getElementById("quick-donate-close"),v=document.getElementById("modal-content"),H=document.getElementById("donation-amount"),q=document.querySelectorAll(".quick-amount-btn"),C=document.getElementById("donate-submit-btn"),p=document.getElementById("payment-request-button"),w=document.getElementById("payment-processing"),_=document.getElementById("payment-success");document.getElementById("email-collection");const M=()=>{if(!E){p?.classList.add("hidden"),C?.classList.remove("hidden");return}y=E.paymentRequest({country:"US",currency:"usd",total:{label:"Donation to The Kumlawdi Foundation",amount:k*100},requestPayerEmail:!0});const n=E.elements().create("paymentRequestButton",{paymentRequest:y,style:{paymentRequestButton:{theme:"dark",height:"48px"}}});y.canMakePayment().then(t=>{t?(n.mount("#payment-request-button"),C?.classList.add("hidden")):(p?.classList.add("hidden"),C?.classList.remove("hidden"))}),y.on("paymentmethod",async t=>{w?.classList.remove("hidden"),p?.classList.add("hidden");try{const s=await fetch(Q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:k*100,currency:"usd"})}),{clientSecret:a,error:i}=await s.json();if(i){t.complete("fail"),alert("Payment failed. Please try again."),w?.classList.add("hidden"),p?.classList.remove("hidden");return}const{error:r}=await E.confirmCardPayment(a,{payment_method:t.paymentMethod.id},{handleActions:!1});if(r)t.complete("fail"),alert("Payment failed: "+r.message),w?.classList.add("hidden"),p?.classList.remove("hidden");else{t.complete("success"),w?.classList.add("hidden"),_?.classList.remove("hidden");const d=document.getElementById("donor-email");t.payerEmail&&d&&(d.value=t.payerEmail),typeof gtag<"u"&&gtag("event","purchase",{transaction_id:t.paymentMethod.id,value:k,currency:"USD"})}}catch(s){t.complete("fail"),console.error("Payment error:",s),alert("Payment failed. Please try again."),w?.classList.add("hidden"),p?.classList.remove("hidden")}})},U=()=>{y&&(y.update({total:{label:"Donation to The Kumlawdi Foundation",amount:k*100}}),M())};let B=!1;b?.addEventListener("click",e=>{if(B){I();return}const n=document.getElementById("modal-cartoons-container"),t=document.getElementById("modal-heart-icon");if(c.length>0&&n&&t)if(window.quickDonateModalCycling&&window.quickDonateModalCycling.start)window.quickDonateModalCycling.start();else{const s=(()=>{const a=document.querySelector("base");return a&&a.href?a.href.replace(window.location.origin,""):window.location.pathname.startsWith("/kumlawdi-website/")?"/kumlawdi-website/":"/"})();n.innerHTML="",c.forEach((a,i)=>{let r="w-16 h-16",d="ring-2 ring-brand-secondary/20";i===0||i===c.length-1?r="w-14 h-14":(r="w-20 h-20",d="ring-2 ring-brand-secondary/30 shadow-md");const u=document.createElement("div");u.className=`${r} rounded-full overflow-hidden ${d} transition-transform duration-300 hover:scale-110`;const o=document.createElement("img");o.src=`${s}${a}`,o.alt="Support our mission",o.className="w-full h-full object-cover rounded-full",u.appendChild(o),n.appendChild(u)}),n.style.display="flex",t.style.display="none"}else n&&(n.style.display="none"),t&&(t.style.display="flex");B=!0,h?.classList.remove("hidden"),h?.classList.add("flex"),setTimeout(()=>{v?.classList.remove("scale-95","opacity-0"),v?.classList.add("scale-100","opacity-100")},10),document.body.style.overflow="hidden",y?U():M()});const I=()=>{B=!1,window.quickDonateModalCycling&&window.quickDonateModalCycling.stop(),w?.classList.add("hidden"),_?.classList.add("hidden"),p?.classList.remove("hidden"),C?.classList.add("hidden"),v?.classList.remove("scale-100","opacity-100"),v?.classList.add("scale-95","opacity-0"),setTimeout(()=>{h?.classList.add("hidden"),h?.classList.remove("flex"),document.body.style.overflow="",typeof window.quickDonateResumeCycle=="function"&&window.quickDonateResumeCycle()},300)};$?.addEventListener("click",I),h?.addEventListener("click",e=>{e.target===h&&I()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!h?.classList.contains("hidden")&&I()}),q.forEach(e=>{e.addEventListener("click",()=>{const n=parseInt(e.dataset.amount||"10");k=n,H.textContent=`$${n}`,q.forEach(t=>t.classList.remove("active","bg-brand-secondary","text-white","border-brand-secondary")),q.forEach(t=>t.classList.add("border-gray-300")),e.classList.add("active","bg-brand-secondary","text-white","border-brand-secondary"),e.classList.remove("border-gray-300"),U()})}),C?.addEventListener("click",async()=>{alert("Card payment coming soon. For now, please use Apple Pay or Google Pay if available.")}),document.getElementById("submit-email")?.addEventListener("click",async()=>{const e=document.getElementById("donor-email")?.value;if(!e){alert("Please enter an email address");return}try{await fetch("/api/save-donor-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),alert("Receipt will be sent to "+e),setTimeout(()=>{I()},2e3)}catch(n){console.error("Error saving email:",n),alert("Email saved. Receipt will be sent shortly."),setTimeout(()=>{I()},2e3)}});const A=()=>{window.innerWidth<640?(b?.classList.remove("right-6","right-8"),b?.classList.add("right-1/2","translate-x-1/2")):(b?.classList.remove("right-1/2","translate-x-1/2"),b?.classList.add("right-6","md:right-8"))};A(),window.addEventListener("resize",A)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P()})();
